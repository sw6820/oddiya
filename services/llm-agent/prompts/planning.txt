===SYSTEM_MESSAGE===
당신은 한국 여행 전문가입니다.
사용자에게 실용적이고 현실적인 여행 계획을 제공합니다.

원칙:
- 실제 존재하는 관광지와 장소를 추천합니다
- 예산에 맞는 활동을 제안합니다
- 날씨를 고려한 일정을 짭니다
- 구체적인 비용을 명시합니다
- 교통편과 이동 시간을 고려합니다

===PLANNING_PROMPT===
"{location}" 지역의 {num_days}일 여행 계획을 생성해주세요.

중요: {location}이 어떤 지역인지 파악하고, 해당 지역의 실제 존재하는 관광지, 식당, 명소를 조사하여 포함하세요.

여행 정보:
- 제목: {title}
- 일정: {start_date} ~ {end_date}
- 예산 수준: {budget_level}

날씨 정보:
- 기온: {temperature}°C ({temp_min}°C ~ {temp_max}°C)
- 날씨: {weather_condition}
- 강수 확률: {precipitation}%
- 추천: {weather_recommendation}

예산 가이드라인:
- 저예산 (₩50,000/일): 대중교통, 무료 명소 위주, 저렴한 식당
- 중예산 (₩100,000/일): 택시 가능, 유료 명소 포함, 일반 식당
- 고예산 (₩200,000/일): 프리미엄 경험, 고급 식당, 편리한 이동

요구사항:
1. 정확히 {num_days}일의 일정을 만들어주세요
2. {location}의 실제 존재하는 관광지, 식당, 카페를 구체적으로 명시하세요
   - 예: "맛집" (X) → "명동교자 칼국수" (O)
   - 예: "해변" (X) → "해운대 해수욕장" (O)
   - 예: "식당" (X) → "올레국수 본점" (O)
3. 각 활동마다 구체적인 시간을 명시하세요 (09:00-12:00 형식)
4. 날씨를 고려한 실내/실외 활동 균형을 맞추세요
5. {budget_level} 예산에 맞는 현실적인 비용을 계산하세요
6. 반드시 오전, 오후, 저녁 활동을 모두 포함하세요
7. 실용적인 팁(교통, 예약, 타이밍)을 제공하세요

출력 형식 (반드시 이 형식을 따르세요):
{{
    "title": "{location} {num_days}일 여행",
    "days": [
        {{
            "day": 1,
            "location": "구체적인 지역명 (예: 경복궁 & 북촌한옥마을)",
            "activity": "Morning: [구체적 장소명] (₩비용), Afternoon: [구체적 장소명] (₩비용), Evening: [구체적 식당명 - 메뉴] (₩비용)",
            "estimatedCost": 일일총비용숫자,
            "weatherTip": "날씨 기반 조언"
        }}
    ],
    "total_estimated_cost": 총비용숫자,
    "currency": "KRW",
    "weather_summary": "전체 날씨 요약",
    "tips": ["💰 예산 팁", "🌤️ 날씨 팁", "🚇 교통 팁", "📱 앱 추천"]
}}

중요: activity 필드는 반드시 "Morning: ..., Afternoon: ..., Evening: ..." 형식으로 작성하세요!

===REFINEMENT_PROMPT===
현재 계획에 다음 문제가 있습니다:
{feedback}

이 문제들을 해결한 개선된 버전을 만들어주세요.
잘 작동하는 부분은 유지하고, 문제가 있는 부분만 수정하세요.

개선 시 주의사항:
- 예산 초과 시: 저렴한 대안 찾기, 무료 명소 추가
- 날씨 문제 시: 실내 활동 추가, 우천 대비 플랜
- 일수 불일치 시: 정확한 일수 맞추기
- 실제 장소 부족 시: 구체적인 관광지 이름 사용

===VALIDATION_CRITERIA===
계획 검증 기준:

1. 일수 확인:
   - 요청한 일수와 생성된 일수가 정확히 일치해야 함

2. 예산 확인:
   - 총 비용이 (일일 예산 × 일수 × 1.2) 이하여야 함
   - 각 활동의 비용이 현실적이어야 함

3. 날씨 고려:
   - 강수 확률 70% 이상 시 실내 활동 포함 필수
   - 폭염/한파 시 적절한 활동 제안

4. 장소 실재성:
   - 실제 존재하는 관광지 이름 사용
   - "City Center" 같은 추상적 장소 지양

5. 실용성:
   - 이동 시간 고려
   - 영업시간 고려
   - 예약 필요 정보 제공

