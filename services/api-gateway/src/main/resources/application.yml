spring:
  application:
    name: api-gateway
  cloud:
    gateway:
      routes:
        # Auth Service routes (API endpoints)
        - id: auth-service
          uri: http://localhost:8081
          predicates:
            - Path=/api/auth/**,/api/v1/auth/**
          filters:
            - RewritePath=/api/(?:v1/)?auth(?<segment>/?.*), /api/v1/auth$\{segment}

        # OAuth2 routes (for browser-based OAuth flow)
        - id: oauth2-authorize
          uri: http://localhost:8081
          predicates:
            - Path=/oauth2/**
          filters:
            - RewritePath=/oauth2(?<segment>/?.*), /oauth2$\{segment}

        # OAuth2 callback route (Spring Security OAuth2 Client default)
        - id: oauth2-callback
          uri: http://localhost:8081
          predicates:
            - Path=/login/oauth2/**
          filters:
            - RewritePath=/login/oauth2(?<segment>/?.*), /login/oauth2$\{segment}
        
        # User Service routes
        - id: user-service
          uri: http://localhost:8082
          predicates:
            - Path=/api/users/**,/api/v1/users/**
          filters:
            - RewritePath=/api/(?:v1/)?users(?<segment>/?.*), /api/v1/users$\{segment}
        
        # Plan Service routes
        - id: plan-service
          uri: http://localhost:8083
          predicates:
            - Path=/api/plans,/api/plans/**,/api/v1/plans,/api/v1/plans/**
          filters:
            - RewritePath=/api/(?:v1/)?plans(?<segment>/?.*), /api/v1/plans$\{segment}

        # Video Service routes
        - id: video-service
          uri: http://localhost:8084
          predicates:
            - Path=/api/videos,/api/videos/**
          filters:
            - RewritePath=/api/videos(?<segment>/?.*), /api/v1/videos$\{segment}

        # Plan Photo routes
        - id: plan-photos
          uri: http://localhost:8083
          predicates:
            - Path=/api/plans/*/photos,/api/plans/*/photos/**
          filters:
            - RewritePath=/api/plans/([^/]+)/photos(/?.*), /api/v1/plans/$\1/photos$\2

        # Plan Profile routes
        - id: plan-profile
          uri: http://localhost:8083
          predicates:
            - Path=/api/profile/**
          filters:
            - RewritePath=/api/profile(?<segment>/?.*), /api/v1/profile$\{segment}
  
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}

# Server Configuration
server:
  port: 8080

# Management Configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: when-authorized

logging:
  level:
    com.oddiya.gateway: DEBUG
    com.oddiya.gateway.filter: DEBUG
    org.springframework.cloud.gateway: DEBUG

